---
// Dynamic paths from markdown files
import { marked } from 'marked';

export async function getStaticPaths() {
  // Dynamically generate paths from all markdown files
  const posts = import.meta.glob('/content/posts/*.md', { eager: true });

  const recipes = Object.entries(posts).map(([path, post]: [string, any]) => {
    const slug = path.split('/').pop()?.replace('.md', '') || '';
    return {
      slug,
      filePath: path.replace('/Users/adnandossaji/Work/other/personal-websites/kapods-kitchen/', '')
    };
  });

  const processedRecipes = recipes.map(({ slug, filePath }) => {
    try {
      // Get the post content from import.meta.glob
      const post = posts[filePath];

      if (post && post.frontmatter) {
        // In Astro, post.default should be the rendered HTML
        let content = '';
        if (typeof post.default === 'string') {
          content = post.default;
        } else {
          // Fallback: try to get raw content and process it
          try {
            const raw = typeof post.rawContent === 'function' ? post.rawContent() : post.rawContent;
            content = raw ? marked(raw) : '<p>Content coming soon...</p>';
          } catch (e) {
            console.error(`Error processing content for ${slug}:`, e);
            content = '<p>Content coming soon...</p>';
          }
        }

        return {
          params: { slug },
          props: {
            recipe: {
              id: slug,
              data: post.frontmatter,
              content: content
            }
          }
        };
      } else {
        // Fallback if frontmatter is missing
        return {
          params: { slug },
          props: {
            recipe: {
              id: slug,
              data: { title: slug, description: 'Content coming soon...' },
              content: '# Coming Soon\n\nThis recipe is being prepared...'
            }
          }
        };
      }
    } catch (error) {
      console.error(`Error processing ${filePath}:`, error);
      return {
        params: { slug },
        props: {
          recipe: {
            id: slug,
            data: { title: slug, description: 'Content coming soon...' },
            content: '# Coming Soon\n\nThis recipe is being prepared...'
          }
        }
      };
    }
  });

  return processedRecipes;
}

const { recipe } = Astro.props;
---
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>{recipe.data.title} - Kapods Kitchen</title>
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
		<style>
			:root {
				/* Kapods Color Palette - Sarah's Favorites (Softer) */
				--primary: #A8E6CF;        /* Soft Mint Green */
				--primary-dark: #7BC9A6;   /* Darker Mint */
				--primary-light: #D4F4E8;  /* Light Mint */
				--secondary: #C77DFF;      /* Purple */
				--accent: #FF6B9D;         /* Pink */
				--blue: #4ECDC4;           /* Teal Blue */
				--yellow: #FFD23F;         /* Bright Yellow (accent only) */
				--cream: #FEFCF7;          /* Warm Cream */
				--warm-gray: #F7F5F2;      /* Light Gray */
				--text-dark: #2D3748;      /* Dark Blue-Gray */
				--text-medium: #4A5568;    /* Medium Gray */
				--text-light: #718096;     /* Light Gray */
				--border: #E2E8F0;         /* Border Gray */
				--shadow: rgba(168, 230, 207, 0.15);  /* Mint-tinted shadow */
				--shadow-hover: rgba(168, 230, 207, 0.25);

				/* Typography */
				--font-heading: 'Playfair Display', serif;
				--font-body: 'Inter', sans-serif;

				/* Spacing */
				--space-xs: 0.25rem;
				--space-sm: 0.5rem;
				--space-md: 1rem;
				--space-lg: 1.5rem;
				--space-xl: 2rem;
				--space-2xl: 3rem;
				--space-3xl: 4rem;

				/* Border Radius */
				--radius-sm: 0.375rem;
				--radius-md: 0.5rem;
				--radius-lg: 0.75rem;
				--radius-xl: 1rem;
			}

			* {
				box-sizing: border-box;
			}

			body {
				font-family: var(--font-body);
				margin: 0;
				padding: 0;
				line-height: 1.6;
				color: var(--text-dark);
				background-color: var(--cream);
			}

			/* Navigation */
			.nav {
				background: white;
				border-bottom: 1px solid var(--border);
				padding: var(--space-md) 0;
				position: sticky;
				top: 0;
				z-index: 100;
				box-shadow: 0 1px 3px var(--shadow);
			}

			.nav-container {
				max-width: 1200px;
				margin: 0 auto;
				padding: 0 var(--space-lg);
				display: flex;
				justify-content: space-between;
				align-items: center;
			}

			.nav-brand {
				font-family: var(--font-heading);
				font-size: 1.5rem;
				font-weight: 600;
				color: var(--text-dark);
				text-decoration: none;
				position: relative;
			}

			.nav-brand::after {
				content: "üë©‚Äçüç≥";
				position: absolute;
				right: -25px;
				top: -2px;
				font-size: 1rem;
			}

			.back-link {
				display: inline-flex;
				align-items: center;
				gap: var(--space-sm);
				color: var(--text-medium);
				text-decoration: none;
				font-weight: 500;
				font-size: 0.9rem;
				padding: var(--space-sm) var(--space-md);
				border-radius: var(--radius-md);
				transition: all 0.2s ease;
			}

			.back-link:hover {
				background: var(--warm-gray);
				color: var(--text-dark);
			}

			/* Hero Section */
			.recipe-hero {
				background: linear-gradient(135deg, var(--primary) 0%, var(--blue) 100%);
				color: var(--text-dark);
				padding: var(--space-lg) var(--space-lg);
				text-align: center;
				position: relative;
				overflow: hidden;
			}

			.recipe-hero::before {
				content: '';
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
			}

			.recipe-hero-content {
				position: relative;
				z-index: 1;
				max-width: 800px;
				margin: 0 auto;
			}

			.recipe-category-badge {
				display: inline-block;
				background: rgba(255, 255, 255, 0.2);
				color: white;
				padding: var(--space-xs) var(--space-sm);
				border-radius: var(--radius-sm);
				font-size: 0.75rem;
				font-weight: 500;
				text-transform: uppercase;
				letter-spacing: 0.5px;
				margin-bottom: var(--space-lg);
			}

			.recipe-author {
				display: flex;
				align-items: center;
				gap: var(--space-md);
				margin-bottom: var(--space-lg);
				justify-content: center;
			}

			.author-avatar {
				width: 60px;
				height: 60px;
				background: linear-gradient(135deg, var(--accent), var(--secondary));
				border-radius: 50%;
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 1.5rem;
				border: 3px solid white;
				box-shadow: var(--shadow);
			}

			.author-info {
				text-align: left;
			}

			.author-name {
				font-weight: 600;
				color: var(--text-dark);
				font-size: 1.1rem;
			}

			.author-title {
				color: var(--accent);
				font-size: 0.9rem;
				font-style: italic;
			}

			.recipe-title {
				font-family: var(--font-heading);
				font-size: clamp(2rem, 6vw, 3rem);
				font-weight: 700;
				margin: 0 0 var(--space-md) 0;
				line-height: 1.1;
				color: var(--text-dark);
			}

			.recipe-description {
				font-size: 1.125rem;
				margin: 0 0 var(--space-xl) 0;
				line-height: 1.6;
				max-width: 600px;
				margin-left: auto;
				margin-right: auto;
			}

			.recipe-tags {
				display: flex;
				gap: var(--space-md);
				flex-wrap: wrap;
				justify-content: center;
			}

			.recipe-tag {
				background: rgba(255, 255, 255, 0.9);
				color: var(--text-medium);
				padding: var(--space-xs) var(--space-sm);
				border-radius: var(--radius-lg);
				font-size: 0.8rem;
				font-weight: 500;
				border: 2px solid var(--secondary);
			}

			/* Meta Information */
			.recipe-meta {
				display: flex;
				justify-content: center;
				gap: var(--space-xl);
				flex-wrap: wrap;
				margin-bottom: var(--space-3xl);
			}

			.recipe-meta-compact {
				display: flex;
				justify-content: center;
				gap: var(--space-lg);
				flex-wrap: wrap;
				font-size: 0.9rem;
				opacity: 0.9;
			}

			.recipe-meta-compact span {
				background: rgba(255, 255, 255, 0.1);
				padding: var(--space-xs) var(--space-sm);
				border-radius: var(--radius-sm);
			}

			.meta-item {
				display: flex;
				flex-direction: column;
				align-items: center;
				text-align: center;
				min-width: 100px;
			}

			.meta-icon {
				font-size: 1.5rem;
				margin-bottom: var(--space-xs);
			}

			.meta-label {
				font-size: 0.75rem;
				text-transform: uppercase;
				letter-spacing: 0.5px;
				opacity: 0.8;
				margin-bottom: var(--space-xs);
			}

			.meta-value {
				font-size: 1.125rem;
				font-weight: 600;
			}

			/* Main Content */
			.recipe-content {
				padding: var(--space-lg) var(--space-lg);
			}

			.content-container {
				max-width: 1200px;
				margin: 0 auto;
				display: grid;
				grid-template-columns: 1fr 300px;
				gap: var(--space-3xl);
			}

			/* Recipe Image */
			.recipe-image-section {
				margin-bottom: var(--space-3xl);
			}

			.recipe-image-container {
				position: relative;
				border-radius: var(--radius-xl);
				overflow: hidden;
				box-shadow: 0 8px 32px var(--shadow);
				background: var(--warm-gray);
			}

			.recipe-image {
				width: 100%;
				height: 400px;
				object-fit: cover;
				display: block;
			}

			.recipe-image-placeholder {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: linear-gradient(135deg, var(--primary-light), var(--blue));
				display: flex;
				align-items: center;
				justify-content: center;
				border-radius: var(--radius-xl);
				font-size: 4rem;
				color: var(--primary);
				opacity: 0.3;
			}

			/* Recipe Sections */
			.recipe-section {
				background: white;
				border-radius: var(--radius-xl);
				padding: var(--space-lg);
				margin-bottom: var(--space-lg);
				box-shadow: 0 4px 6px var(--shadow);
			}

			.section-header {
				display: flex;
				align-items: center;
				gap: var(--space-md);
				margin-bottom: var(--space-xl);
				padding-bottom: var(--space-lg);
				border-bottom: 2px solid var(--warm-gray);
			}

			.section-icon {
				font-size: 1.5rem;
			}

			.section-title {
				font-family: var(--font-heading);
				font-size: 1.75rem;
				font-weight: 600;
				margin: 0;
				color: var(--text-dark);
			}

			/* Ingredients */
			.ingredients-list {
				display: grid;
				gap: var(--space-md);
			}

			.ingredient-item {
				display: flex;
				align-items: center;
				padding: var(--space-md);
				background: var(--warm-gray);
				border-radius: var(--radius-md);
				transition: all 0.2s ease;
			}

			.ingredient-item:hover {
				background: var(--primary-light);
				transform: translateX(4px);
			}

			.ingredient-checkbox {
				margin-right: var(--space-md);
				width: 18px;
				height: 18px;
				cursor: pointer;
			}

			.ingredient-amount {
				font-weight: 600;
				color: var(--primary);
				min-width: 80px;
			}

			.ingredient-text {
				flex: 1;
			}

			/* Instructions */
			.instructions-list {
				counter-reset: step-counter;
			}

			.instruction-item {
				display: flex;
				gap: var(--space-lg);
				padding: var(--space-xl) 0;
				border-bottom: 1px solid var(--border);
				position: relative;
			}

			.instruction-item:last-child {
				border-bottom: none;
			}

			.instruction-number {
				counter-increment: step-counter;
				display: flex;
				align-items: center;
				justify-content: center;
				width: 40px;
				height: 40px;
				background: var(--primary);
				color: white;
				border-radius: 50%;
				font-weight: 600;
				font-size: 1.125rem;
				flex-shrink: 0;
				position: relative;
				z-index: 1;
			}

			.instruction-number::before {
				content: counter(step-counter);
			}

			.instruction-text {
				flex: 1;
				line-height: 1.7;
				padding-top: var(--space-sm);
			}

			/* Tags */
			.tags-section {
				margin-top: var(--space-2xl);
			}

			.tags-grid {
				display: flex;
				flex-wrap: wrap;
				gap: var(--space-sm);
			}

			.tag {
				display: inline-block;
				background: var(--warm-gray);
				color: var(--text-medium);
				padding: var(--space-sm) var(--space-md);
				border-radius: var(--radius-lg);
				font-size: 0.875rem;
				font-weight: 500;
				transition: all 0.2s ease;
			}

			.tag:hover {
				background: var(--primary);
				color: white;
			}

			/* Sidebar */
			.recipe-sidebar {
				position: sticky;
				top: 100px;
				height: fit-content;
			}

			.sidebar-section {
				background: white;
				border-radius: var(--radius-xl);
				padding: var(--space-xl);
				margin-bottom: var(--space-xl);
				box-shadow: 0 4px 6px var(--shadow);
			}

			.sidebar-title {
				font-family: var(--font-heading);
				font-size: 1.25rem;
				font-weight: 600;
				margin: 0 0 var(--space-lg) 0;
				color: var(--text-dark);
			}

			.nutrition-facts {
				display: grid;
				gap: var(--space-sm);
			}

			.nutrition-item {
				display: flex;
				justify-content: space-between;
				padding: var(--space-sm) 0;
				border-bottom: 1px solid var(--border);
			}

			.nutrition-item:last-child {
				border-bottom: none;
			}

			.nutrition-label {
				color: var(--text-medium);
			}

			.nutrition-value {
				font-weight: 600;
				color: var(--text-dark);
			}

			/* Print Styles */
			@media print {
				.nav, .recipe-sidebar {
					display: none;
				}

				.recipe-content {
					padding: 0;
				}

				.content-container {
					grid-template-columns: 1fr;
					gap: var(--space-xl);
				}

				.recipe-section {
					break-inside: avoid;
				}
			}

			/* Blog Content Styles */
			.blog-content {
				background: white;
				border-radius: var(--radius-xl);
				padding: var(--space-2xl);
				margin-bottom: var(--space-2xl);
				box-shadow: 0 4px 6px var(--shadow);
			}

			.content-wrapper {
				max-width: none;
			}

			.content-wrapper h1,
			.content-wrapper h2,
			.content-wrapper h3,
			.content-wrapper h4,
			.content-wrapper h5,
			.content-wrapper h6 {
				font-family: var(--font-heading);
				color: var(--text-dark);
				margin-top: var(--space-xl);
				margin-bottom: var(--space-md);
				line-height: 1.3;
			}

			.content-wrapper h1 {
				font-size: 2rem;
				margin-top: 0;
			}

			.content-wrapper h2 {
				font-size: 1.5rem;
				border-bottom: 2px solid var(--warm-gray);
				padding-bottom: var(--space-sm);
			}

			.content-wrapper p {
				line-height: 1.7;
				margin-bottom: var(--space-lg);
				color: var(--text-medium);
			}

			.content-wrapper ul,
			.content-wrapper ol {
				margin-bottom: var(--space-lg);
				padding-left: var(--space-xl);
			}

			.content-wrapper li {
				margin-bottom: var(--space-sm);
				line-height: 1.6;
			}

			.content-wrapper strong,
			.content-wrapper b {
				font-weight: 600;
				color: var(--text-dark);
			}

			.content-wrapper em,
			.content-wrapper i {
				font-style: italic;
				color: var(--text-medium);
			}

			/* Responsive Design */
			@media (max-width: 1024px) {
				.content-container {
					grid-template-columns: 1fr;
					gap: var(--space-2xl);
				}

				.recipe-sidebar {
					position: static;
				}
			}

			@media (max-width: 768px) {
				.recipe-hero {
					padding: var(--space-lg) var(--space-md);
				}

				.recipe-title {
					font-size: 2rem;
				}

				.recipe-description {
					font-size: 1.1rem;
				}

				.recipe-content {
					padding: var(--space-lg) var(--space-md);
				}

				.blog-content {
					padding: var(--space-lg);
				}

				.content-wrapper h1 {
					font-size: 1.75rem;
				}

				.content-wrapper h2 {
					font-size: 1.25rem;
				}
			}
		</style>
	</head>
	<body>
		<!-- Navigation -->
		<nav class="nav">
			<div class="nav-container">
				<a href="../../" class="nav-brand">Kapods Kitchen</a>
				<a href="../../" class="back-link">
					<span>‚Üê</span>
					Back to Recipes
				</a>
			</div>
		</nav>

		<!-- Personal Recipe Header -->
		<section class="recipe-hero">
			<div class="recipe-hero-content">
				<div class="recipe-author">
					<div class="author-avatar">üë©‚Äçüç≥</div>
					<div class="author-info">
						<div class="author-name">Sarah Kapadia</div>
						<div class="author-title">Kapods Kitchen</div>
					</div>
				</div>

				<h1 class="recipe-title">{recipe.data.title}</h1>
				<p class="recipe-description">{recipe.data.description}</p>

				<div class="recipe-tags">
					<span class="recipe-tag">üçΩÔ∏è Recipe</span>
					<span class="recipe-tag">üìù Personal</span>
					<span class="recipe-tag">‚ù§Ô∏è Made with Love</span>
				</div>
			</div>
		</section>

		<!-- Main Content -->
		<main class="recipe-content">
			<div class="content-container">
				<div class="recipe-main">
					<!-- Recipe Image -->
					<section class="recipe-image-section">
						<div class="recipe-image-container">
							<img src={recipe.data.heroImage || `https://placehold.co/800x400?text=${encodeURIComponent(recipe.data.category || 'No Image')}`} alt={recipe.data.title} class="recipe-image" />
						</div>
					</section>

					<!-- Post Content -->
					<section class="post-content">
						<div class="content-wrapper">
							{recipe.data.category === 'Recipes' ? (
								<div class="recipe-content-wrapper" set:html={recipe.content || '<p>Recipe content coming soon...</p>'}></div>
							) : (
								<div class="blog-content-wrapper" set:html={recipe.content || '<p>Content coming soon...</p>'}></div>
							)}
						</div>
					</section>
				</div>

				<!-- Optional Sidebar for Recipes -->
				{recipe.data.category === 'Recipes' && (
					<aside class="recipe-sidebar">
						<div class="sidebar-section">
							<h3 class="sidebar-title">About This Recipe</h3>
							<div class="category-tag">{recipe.data.category}</div>
							<p class="sidebar-description">A delicious recipe from my kitchen to yours! Made with love and simple ingredients. üíï</p>
						</div>

						<div class="sidebar-section">
							<h3 class="sidebar-title">Quick Actions</h3>
							<button onclick="window.print()" style="width: 100%; padding: var(--space-md); background: var(--primary); color: white; border: none; border-radius: var(--radius-md); font-weight: 500; cursor: pointer; transition: background 0.2s ease;" onmouseover="this.style.background='var(--primary-dark)'" onmouseout="this.style.background='var(--primary)'">
								üñ®Ô∏è Print Recipe
							</button>
						</div>
					</aside>
				)}
			</div>
		</main>

		<script>
			// Handle ingredient checkboxes
			document.addEventListener('DOMContentLoaded', function() {
				const checkboxes = document.querySelectorAll('.ingredient-checkbox');
				checkboxes.forEach(checkbox => {
					checkbox.addEventListener('change', function() {
						const item = this.parentElement;
						if (this.checked) {
							item.style.opacity = '0.6';
							item.style.textDecoration = 'line-through';
						} else {
							item.style.opacity = '1';
							item.style.textDecoration = 'none';
						}
					});
				});
			});
		</script>
	</body>
</html>
